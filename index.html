<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Notas App</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 600px;
      margin: 50px auto;
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1 { text-align: center; color: #333; }
    button { margin: 5px; padding: 8px 12px; font-size: 14px; cursor: pointer; }
    ul { list-style: none; padding: 0; }
    li {
      padding: 10px;
      border-bottom: 1px solid #ddd;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .nota-text { flex: 1; }
    .nota-actions button { margin-left: 5px; }
    #formNota { display: flex; flex-direction: column; margin-bottom: 20px; }
    #formNota input { margin: 5px 0; padding: 8px; font-size: 14px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Notas App</h1>
    <form id="formNota">
      <input type="text" id="titulo" placeholder="Título" required>
      <input type="text" id="descricao" placeholder="Descrição" required>
      <button type="submit">Adicionar / Atualizar Nota</button>
    </form>

    <button id="refreshBtn">Atualizar Lista</button>
    <ul id="notasList"></ul>
  </div>

  <script>
    // Proxy CORS para evitar bloqueio do navegador
    const corsProxy = 'https://cors-anywhere.herokuapp.com/';
    const apiBase = 'https://notas-api-qvzz.onrender.com/notas';
    const apiUrl = corsProxy + apiBase;

    const notasList = document.getElementById('notasList');
    const refreshBtn = document.getElementById('refreshBtn');
    const formNota = document.getElementById('formNota');
    const tituloInput = document.getElementById('titulo');
    const descricaoInput = document.getElementById('descricao');

    let editId = null;

    async function fetchNotas() {
      notasList.innerHTML = '<li>Carregando...</li>';
      try {
        const response = await fetch(apiUrl);
        if (!response.ok) throw new Error('Erro ao carregar notas');

        const notas = await response.json();
        renderNotas(notas);
      } catch (err) {
        notasList.innerHTML = '<li>Erro ao carregar notas</li>';
        console.error(err);
      }
    }

    function renderNotas(notas) {
      if (notas.length === 0) {
        notasList.innerHTML = '<li>Nenhuma nota encontrada</li>';
        return;
      }

      notasList.innerHTML = '';
      notas.forEach(nota => {
        const li = document.createElement('li');

        const textDiv = document.createElement('div');
        textDiv.className = 'nota-text';
        textDiv.textContent = `${nota.titulo}: ${nota.descricao}`;

        const actionsDiv = document.createElement('div');
        actionsDiv.className = 'nota-actions';

        const editBtn = document.createElement('button');
        editBtn.textContent = 'Editar';
        editBtn.onclick = () => {
          tituloInput.value = nota.titulo;
          descricaoInput.value = nota.descricao;
          editId = nota.id;
        };

        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'Deletar';
        deleteBtn.onclick = async () => {
          await fetch(corsProxy + apiBase + '/' + nota.id, { method: 'DELETE' });
          fetchNotas();
        };

        actionsDiv.appendChild(editBtn);
        actionsDiv.appendChild(deleteBtn);

        li.appendChild(textDiv);
        li.appendChild(actionsDiv);

        notasList.appendChild(li);
      });
    }

    formNota.addEventListener('submit', async (e) => {
      e.preventDefault();
      const titulo = tituloInput.value;
      const descricao = descricaoInput.value;

      if (editId) {
        await fetch(corsProxy + apiBase + '/' + editId, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ titulo, descricao })
        });
        editId = null;
      } else {
        await fetch(apiUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ titulo, descricao })
        });
      }

      tituloInput.value = '';
      descricaoInput.value = '';
      fetchNotas();
    });

    refreshBtn.addEventListener('click', fetchNotas);

    fetchNotas();
  </script>
</body>
</html>
